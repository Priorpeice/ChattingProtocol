# 나만의 채팅 프로토콜

## My Chatting Protocol

## 💡 프로젝트 소개

- 자신만의 채팅 프로토콜을 설계 및 구현하는 프로젝트입니다.
- 프로토콜은 7계층 프로토콜을 설계한 것이고 소켓 통신을 이용하여 채팅 프로그램을 구현하였습니다.

## ⚙️ 프로젝트 개발 환경

- 프로그래밍 언어 : JAVA
- 개발 도구: intellj
- DBMS : Mysql

## 📚 기능

- 채팅 기능
    - 채팅을 구현하기 위해서는 다음과 같은 소켓을 이용한 네트워크 연결 절차를 이해할 필요가 있었습니다.
    
    ![%EC%86%8C%EC%BC%93%EA%B3%BC%EC%A0%95](https://github.com/user-attachments/assets/402d644c-9623-498a-bd66-4004a2d117da)

    간단하게 구현하는 관점에서 두 가지를 중점으로 보았습니다.
    
    1. 지속해서 클라이언트의 connect 요청을 받는 소켓
    2. 실제로 connect하여 통신을 진행하는 소켓
    
    따라서 구현을 위해서 1번과 2번 기능을 Multi-Thread로써 구현을 하였습니다.
    
    1번으로 MainServer가 계속 connect 요청을 대기하고 있으며 connect을 감지하면 2번 기능을 수행할 Thread를 생성하여 실행합니다.
    
    - 나만의 프로토콜
    
    기본적인 데이터 구조는 헤더와 바디를 나누어 보내게 되는 구조입니다.
    
    이때 헤더 구조는 각 명령어(Method)와 구분자로 나누었습니다.  CLI 기반 프로그램으로 Command를 작성할때 구분자(Sep) ‘/’를 사용함으로써 여러 개의 명령어를 구분할 수 있도록 설계하였습니다.

    ![Untitled](https://github.com/user-attachments/assets/8bbae444-2a29-4f41-bce8-dc8891e40d21)
   
    TimeStamp와 MessageLength는 사용자가 작성해서 보내는것이 아닌 프로그램에서 자동으로 메세지에 더해서 전송하게 됩니다.
    
     
    ![Untitled 1](https://github.com/user-attachments/assets/0e907182-c89b-4362-ac95-5d321165f4a9)
   
    흐름을 간단히 설명하면 송신자가 1대1 채팅 규칙에 따라 데이터를 보내게 됩니다. 이때 서버에서는 데이터를 확인후 수신자 이름으로 연결된 소켓을 찾아 수신자에게 보내게 됩니다. 이 과정에서 서버는 송신자에게도 데이터를 보내게 됩니다. 그 이유는 ‘안전성’ 확보를 위함이였습니다. 
    
    ---
    
    1대1 채팅에서 서버가 받은 문자 길이만큼 다시 클라이언트에게 보내게 설계를 하였습니다.
    왜냐하면 1대1채팅은 보다더 신뢰성 있는 통신이 제공되어야한다고 생각하여
    송신자와 수신자 그리고 서버를 분기점을 두어서 어디서 통신의 오류가 생겼는지 확인하기 위해 이렇게 설계하였습니다.
    
    - 서버
        - 구체적인 소켓 관리는 hashMap 자료구조를 이용하였습니다. 사용자 이름을 key로 사용자의 소켓을 value로써 가지게 됩니다.
        - 기능 구현은 SendHandler에서 구현이 되었으며 BroadCasting 기능과 Sender에게 메시지 갈이 보내기 등의 기능도 있습니다.
    - 클라이언트
        - MessageSender 클래스를 통해 사용자가 입력한 정보를 가공하여 서버로 전송하게 됩니다.
    
- 채팅방 기능
    - 나만의 프로토콜
    
    채팅방에서의 데이터 구조는 아래와 같습니다.
    ![Untitled 2](https://github.com/user-attachments/assets/b4a96b03-0062-4cb3-a71c-ebad693521fd)
    ![Untitled 3](https://github.com/user-attachments/assets/e5505324-38bf-482e-8dbf-1ae124829baf)
  
    하지만 사용자의 입장에서는 Group 명령어 방이름만 작성하는 것으로 복잡한 헤더를 작성하지 않도록 설계 및 구현했습니다.
    
    ![Untitled 4](https://github.com/user-attachments/assets/0d5feadc-7cfe-49fc-ad10-d028e8d84419)
  

흐름은 1대1채팅과 마찬가지로 알맞은 포맷으로 작성 후 서버로 전송하며 서버는 채팅방에 있으면서 온라인인 사용자에게 채팅 내역을 보내게 되고 송신자에게 알림을 보냅니다.

- 서버
    
    채팅방 관리는 자료구조로 Map 안에 value로써 방을 map으로 key는 , value는 set(중복방지)으로 방 사용자를 관리하였습니다. 
    
- 회원 기능
    
    기본적인 id와 password를 보내여 서버에서 인증하는 방식을 채택하였습니다.
    
    password는 Sha-256 알고리즘으로 암호화를 진행하였습니다. 
    
- 매크로 기능
    - CLI 환경에서 실행되는 프로그램인 만큼 타이핑해야하는 글자수가 상당히 많았습니다.
        
        이때 사용자 편의를 위하여 사용자가 미리 등록된 글자를 명령어로 불러온다면 어떨까? 라는 생각에서 착안된 기능입니다. 
        
    
    - 사용법 및 동작방식
    
    addMacro라는 명령어를 통해서 매크로를 등록할 수 있습니다. 
    
    헤더에는 addmacro와 원하는 매크로 이름을 등록합니다.
    
    바디에 해당되는 부분에 자신이 원하는 매크로 기능을 저장하면 됩니다.
    
    ex) to/b/What a wonderful day! → b라는 사용자에게 what a wonderful day! 보낸다는 뜻
    
    이렇게 되면 사용자 폴더에 매크로 폴더가 생성되어 매크로 파일을 이름으로 저장하게 됩니다.
    
    사용자는 매크로를 이용하고 싶을 때 Macro로 라는 명령어를 통해 macro/매크로 이름을 통해 해당 매크로를 수행합니다.
